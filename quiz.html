<style>
    /* On force une hauteur minimale pour √©viter les sauts de mise en page */
    #q-container { min-height: 500px; display: flex; flex-direction: column; }
    .option-btn { transition: all 0.2s; border: 2px solid #f1f5f9; }
    .option-btn.correct { border-color: #22c55e; background-color: #f0fdf4; color: #166534; }
    .option-btn.wrong { border-color: #ef4444; background-color: #fef2f2; color: #991b1b; }
</style>

<body class="bg-white">

    <nav class="sticky top-0 bg-white/90 backdrop-blur-md border-b z-50 p-4">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-blue-600 font-bold font-black italic">ACTUQUIZ.</a>
            <button id="next-btn-top" onclick="nextQuestion()" class="hidden bg-blue-600 text-white px-4 py-2 rounded-xl font-bold text-sm shadow-lg">
                Suivant ‚Üí
            </button>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto p-6">
        <article id="hugo-content" class="prose prose-slate max-w-none mb-10 border-b pb-10">
            </article>

        <section id="quiz-block" class="bg-slate-50 rounded-[2rem] p-6 md:p-10 border border-slate-100 shadow-2xl mb-20">
            
            <div id="q-container">
                <div class="flex justify-between items-center mb-4">
                    <span id="q-category" class="bg-blue-600 text-white text-[10px] font-black px-3 py-1 rounded-full uppercase">INFO</span>
                    <span id="q-counter" class="text-slate-400 text-xs font-bold font-mono text-right">01/10</span>
                </div>

                <div id="text-zone" class="mb-6 min-h-[120px]">
                    <h2 id="q-text" class="text-xl md:text-2xl font-black text-slate-900 leading-tight"></h2>
                    <div id="explanation-box" class="hidden p-4 bg-white rounded-2xl border-2 border-blue-100 text-slate-700 text-sm shadow-sm animate-in fade-in duration-300">
                        <p id="expl-text"></p>
                    </div>
                </div>
                
                <div id="options-grid" class="space-y-3"></div>
            </div>

            <div id="end-screen" class="hidden text-center py-10">
                <div class="text-5xl mb-6">üéØ</div>
                <h2 class="text-3xl font-black text-slate-900 mb-2">Test Termin√©</h2>
                <div class="text-6xl font-black text-blue-600 mb-10" id="final-score">0 / 0</div>
                <a href="index.html" class="inline-block bg-slate-900 text-white px-12 py-4 rounded-2xl font-bold">Retour √† l'accueil</a>
            </div>
        </section>
    </main>

    <script>
        let questions = [];
        let currentIdx = 0;
        let score = 0;

        const params = new URLSearchParams(window.location.search);
        const file = params.get('file');

        async function loadQuiz() {
            const res = await fetch(file);
            const data = await res.json();
            document.getElementById('hugo-content').innerHTML = data.html_affichage || "Contenu non disponible";
            questions = data.questions;
            renderQuestion();
        }

        function renderQuestion() {
            const q = questions[currentIdx];
            
            // Reset affichage
            document.getElementById('q-counter').innerText = `${currentIdx + 1}/${questions.length}`;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('q-text').classList.remove('hidden');
            document.getElementById('explanation-box').classList.add('hidden');
            document.getElementById('next-btn-top').classList.add('hidden');
            
            const grid = document.getElementById('options-grid');
            grid.innerHTML = "";
            
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full p-4 rounded-xl text-left font-bold text-slate-700 bg-white shadow-sm";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i, q.correct, btn);
                grid.appendChild(btn);
            });
        }

        function checkAnswer(idx, correct, btn) {
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.disabled = true);

            // On cache la question et on montre l'explication √† la place (ou juste au dessus)
            document.getElementById('expl-text').innerHTML = `<strong>${idx === correct ? '‚úÖ Bravo !' : '‚ùå Erreur'}</strong><br>${questions[currentIdx].explication}`;
            document.getElementById('explanation-box').classList.remove('hidden');
            document.getElementById('q-text').classList.add('hidden'); // On gagne de la place

            if (idx === correct) {
                btn.classList.add('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                btns[correct].classList.add('correct');
            }
            
            // Apparition du bouton SUIVANT en haut
            document.getElementById('next-btn-top').classList.remove('hidden');
        }

        function nextQuestion() {
            currentIdx++;
            if (currentIdx < questions.length) {
                renderQuestion();
                // On scroll juste un peu pour recentrer le bloc quiz si besoin
                document.getElementById('quiz-block').scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                document.getElementById('q-container').classList.add('hidden');
                document.getElementById('end-screen').classList.remove('hidden');
                document.getElementById('final-score').innerText = `${score} / ${questions.length}`;
                document.getElementById('next-btn-top').classList.add('hidden');
            }
        }

        loadQuiz();
    </script>
</body>
